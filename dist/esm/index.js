import t,{useEffect as e,useRef as a,useState as n}from"react";import r from"google-map-react";import*as o from"d3";var l=function(){return l=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},l.apply(this,arguments)},i=function(a){var n=a.xdim,o=void 0===n?300:n,i=a.ydim,s=void 0===i?300:i,d=a.center,u=void 0===d?{lat:41.73284437919054,lng:-93.93040700837061}:d,g=a.zoom,m=void 0===g?20:g,p=a.getMapData,f=a.size,h=void 0===f?"medium":f,v=a.showAddressInput,y=void 0===v||v,b=a.apiKey,x={small:23,medium:30,large:40},k=t.useState(u),w=k[0],A=k[1],E=t.useState(m),M=E[0],B=E[1],C=t.useState(null),z=C[0],S=C[1],L=t.useState({lat:w.lat- -227e-8,lng:w.lng-131e-6}),P=L[0],I=L[1],R=t.useState({lat:w.lat- -708e-8,lng:w.lng- -16e-5}),O=R[0],U=R[1];e((function(){z&&j(w.lat,w.lng).then((function(t){p({center:{lat:w.lat,lng:w.lng,address:t},zoom:M,markerA:P,markerB:O})}))}),[w,P,O,M]),e((function(){A(u)}),[u]);var G=t.useState(!0),N=G[0],T=G[1],j=function(t,e){var a=new z.api.Geocoder;return new Promise((function(n,r){var o="";a.geocode({location:{lat:t,lng:e}},(function(t,e){"OK"===e?(console.log(t),t[0]?(o=t[0].formatted_address,n(o)):n(o="No results found")):r(o="Geocoder failed due to: "+e)}))}))};return t.createElement("div",{style:{height:"100%",margin:"2px"}},y&&z&&t.createElement(c,{map:z,updatePlace:function(t){if(t.geometry){var e=t.geometry.location.lat(),a=t.geometry.location.lng();A({lat:e,lng:a})}}}),t.createElement("div",{style:{width:o,height:y?s-34:s,border:"1px solid black"}},t.createElement(r,{bootstrapURLKeys:{key:b,libraries:["places"]},draggable:N,center:w,zoom:M,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(t){var e=t.map,a=t.maps,n=t.ref;console.log(e,a,n),S({apiLoaded:!0,instance:e,api:a,ref:n})},onChange:function(t){var e=t.center,a=t.zoom,n=t.bounds,r=t.marginBounds;console.log(e,a,n,r),A(e),I({lat:e.lat- -227e-8,lng:e.lng-131e-6}),U({lat:e.lat- -708e-8,lng:e.lng- -16e-5}),B(a)},options:{mapTypeControl:!0,controlSize:20},onChildMouseDown:function(t,e,a){T(!1)},onChildMouseUp:function(t,e,a){T(!0)},onChildClick:function(t,e){console.log("Child click ",t,e)},onChildMouseMove:function(t,e,a){"0"===t&&I(l({lat:a.lat,lng:a.lng},a)),"1"===t&&U(l({lat:a.lat,lng:a.lng},a))}},t.createElement((function(e){return e.lat,e.lng,t.createElement("img",{src:"./imgs/markerA.svg",style:{transform:"translate(-".concat(48,"%, -").concat(90,"%)")},height:x[h],alt:"Marker A"})}),{key:0,lat:P.lat,lng:P.lng}),t.createElement((function(e){return e.lat,e.lng,t.createElement("img",{src:"./imgs/markerB.svg",style:{transform:"translate(-".concat(48,"%, -").concat(90,"%)")},height:x[h],alt:"Marker B"})}),{key:1,lat:O.lat,lng:O.lng}))))},c=function(r){var o=a(null),l=n(""),i=l[0],c=l[1];return e((function(){var t=new r.map.api.places.Autocomplete(o.current,{types:["address"]});return t.addListener("place_changed",(function(){var e=t.getPlace();console.log(e),r.updatePlace(e)})),t.bindTo("bounds",r.map.instance),console.log(r.map.api.places),function(){t.unbindAll(),r.map.api.event.clearInstanceListeners(t)}}),[]),t.createElement("input",{type:"text",id:"pac-input",className:"controls",style:{width:"100%",height:"30px",padding:"5px",boxSizing:"border-box",marginBottom:"4px"},placeholder:"Enter a location",value:i,ref:o,onChange:function(t){return c(t.target.value)}})},s=function(a){var n=a.floorPlan,r=a.xdim,l=void 0===r?300:r,i=a.ydim,c=void 0===i?300:i,s=a.size,d=void 0===s?"large":s,u=a.getCalibrationData,g=t.useRef(null),m={small:23,medium:30,large:40},p={small:7.5,medium:9.5,large:12.4},f={small:21,medium:27,large:36};e((function(){var t=o.select(g.current);h(t)}),[]);var h=function(t){if(t.select("#A").empty()){var e=l/3,a=c/2;v(t.append("svg:image").attr("class","pointer").attr("data-id","A").attr("data-label","Marker A").attr("xlink:href","./imgs/markerA.svg").attr("height",m[d]).attr("x",e).attr("y",a).attr("id","A").style("cursor","pointer").style("transform","translate(-".concat(p[d],"px, -").concat(f[d],"px)")),t)}if(t.select("#B").empty()){var n=2*l/3,r=c/2;v(t.append("svg:image").attr("class","pointer").attr("data-id","B").attr("data-label","Marker B").attr("xlink:href","./imgs/markerB.svg").attr("height",m[d]).attr("x",n).attr("y",r).attr("id","B").style("cursor","pointer").style("transform","translate(-".concat(p[d],"px, -").concat(f[d],"px)")),t)}};function v(t,e){t.call(o.drag().on("start",(function(e){t.raise().classed("active",!0)})).on("drag",(function(e){var a=o.pointer(e,g.current);t.attr("x",a[0]).attr("y",a[1])})).on("end",(function(a){t.classed("active",!1),function(t){var e=[];t.selectAll(".pointer").each((function(t,a){var n=o.select(this).attr("x"),r=o.select(this).attr("y"),l=o.select(this).attr("data-id"),i=o.select(this).attr("data-label");e.push({id:l,label:i,coordinates:[Number(n),Number(r)]})})),e.sort((function(t,e){return t.id>e.id?1:-1})),u(e)}(e)})))}return t.createElement("div",{style:{width:l,height:c,margin:"2px",border:"1px solid black"}},t.createElement("svg",{ref:g,width:"100%",height:"100%",viewBox:"0 0 ".concat(l," ").concat(c),preserveAspectRatio:"xMinYMin",style:{backgroundImage:"url(".concat(n,")"),backgroundSize:"contain",backgroundRepeat:"round"}}))},d=function(t){return new Promise((function(e,a){var n=new Image;n.onload=function(){var t=n.naturalWidth,a=n.naturalHeight;e({width:t,height:a})},n.onerror=function(){a("There was some problem with the image.")},n.src=URL.createObjectURL(t)}))};export{s as CalibrateFloor,i as CalibrateMap,d as imageDimensions};
//# sourceMappingURL=index.js.map
