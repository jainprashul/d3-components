"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("google-map-react"),a=require("d3");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var l=n(e),o=n(t),i=r(a),c=function(){return c=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c.apply(this,arguments)},s=function(t){var a=e.useRef(null),n=e.useState(""),r=n[0],o=n[1];return e.useEffect((function(){var e=new t.map.api.places.Autocomplete(a.current,{types:["address"]});return e.addListener("place_changed",(function(){var a=e.getPlace();console.log(a),t.updatePlace(a)})),e.bindTo("bounds",t.map.instance),console.log(t.map.api.places),function(){e.unbindAll(),t.map.api.event.clearInstanceListeners(e)}}),[]),l.default.createElement("input",{type:"text",id:"pac-input",className:"controls",style:{width:"100%",height:"30px",padding:"5px",boxSizing:"border-box",marginBottom:"4px"},placeholder:"Enter a location",value:r,ref:a,onChange:function(e){return o(e.target.value)}})};exports.CalibrateFloor=function(t){var a=t.floorPlan,n=t.xdim,r=void 0===n?300:n,o=t.ydim,c=void 0===o?300:o,s=t.size,u=void 0===s?"large":s,d=t.getCalibrationData,f=l.default.useRef(null),g={small:23,medium:30,large:40},m={small:7.5,medium:9.5,large:12.4},p={small:21,medium:27,large:36};e.useEffect((function(){var e=i.select(f.current);v(e)}),[]);var v=function(e){if(e.select("#A").empty()){var t=r/3,a=c/2;h(e.append("svg:image").attr("class","pointer").attr("data-id","A").attr("data-label","Marker A").attr("xlink:href","./imgs/markerA.svg").attr("height",g[u]).attr("x",t).attr("y",a).attr("id","A").style("cursor","pointer").style("transform","translate(-".concat(m[u],"px, -").concat(p[u],"px)")),e)}if(e.select("#B").empty()){var n=2*r/3,l=c/2;h(e.append("svg:image").attr("class","pointer").attr("data-id","B").attr("data-label","Marker B").attr("xlink:href","./imgs/markerB.svg").attr("height",g[u]).attr("x",n).attr("y",l).attr("id","B").style("cursor","pointer").style("transform","translate(-".concat(m[u],"px, -").concat(p[u],"px)")),e)}};function h(e,t){e.call(i.drag().on("start",(function(t){e.raise().classed("active",!0)})).on("drag",(function(t){var a=i.pointer(t,f.current);e.attr("x",a[0]).attr("y",a[1])})).on("end",(function(a){e.classed("active",!1),function(e){var t=[];e.selectAll(".pointer").each((function(e,a){var n=i.select(this).attr("x"),r=i.select(this).attr("y"),l=i.select(this).attr("data-id"),o=i.select(this).attr("data-label");t.push({id:l,label:o,coordinates:[Number(n),Number(r)]})})),t.sort((function(e,t){return e.id>t.id?1:-1})),d(t)}(t)})))}return l.default.createElement("div",{style:{width:r,height:c,margin:"2px",border:"1px solid black"}},l.default.createElement("svg",{ref:f,width:"100%",height:"100%",viewBox:"0 0 ".concat(r," ").concat(c),preserveAspectRatio:"xMinYMin",style:{backgroundImage:"url(".concat(a,")"),backgroundSize:"contain",backgroundRepeat:"round"}}))},exports.CalibrateMap=function(t){var a=t.xdim,n=void 0===a?300:a,r=t.ydim,i=void 0===r?300:r,u=t.center,d=void 0===u?{lat:41.73284437919054,lng:-93.93040700837061}:u,f=t.zoom,g=void 0===f?20:f,m=t.getMapData,p=t.size,v=void 0===p?"medium":p,h=t.showAddressInput,y=void 0===h||h,b=t.apiKey,x={small:23,medium:30,large:40},k=l.default.useState(d),w=k[0],E=k[1],A=l.default.useState(g),M=A[0],C=A[1],O=l.default.useState(null),B=O[0],j=O[1],z=l.default.useState({lat:w.lat- -227e-8,lng:w.lng-131e-6}),P=z[0],S=z[1],L=l.default.useState({lat:w.lat- -708e-8,lng:w.lng- -16e-5}),R=L[0],I=L[1];e.useEffect((function(){B&&G(w.lat,w.lng).then((function(e){m({center:{lat:w.lat,lng:w.lng,address:e},zoom:M,markerA:P,markerB:R})}))}),[w,P,R,M]),e.useEffect((function(){E(d)}),[d]);var _=l.default.useState(!0),D=_[0],U=_[1],G=function(e,t){var a=new B.api.Geocoder;return new Promise((function(n,r){var l="";a.geocode({location:{lat:e,lng:t}},(function(e,t){"OK"===t?(console.log(e),e[0]?(l=e[0].formatted_address,n(l)):n(l="No results found")):r(l="Geocoder failed due to: "+t)}))}))};return l.default.createElement("div",{style:{height:"100%",margin:"2px"}},y&&B&&l.default.createElement(s,{map:B,updatePlace:function(e){if(e.geometry){var t=e.geometry.location.lat(),a=e.geometry.location.lng();E({lat:t,lng:a})}}}),l.default.createElement("div",{style:{width:n,height:y?i-34:i,border:"1px solid black"}},l.default.createElement(o.default,{bootstrapURLKeys:{key:b,libraries:["places"]},draggable:D,center:w,zoom:M,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(e){var t=e.map,a=e.maps,n=e.ref;console.log(t,a,n),j({apiLoaded:!0,instance:t,api:a,ref:n})},onChange:function(e){var t=e.center,a=e.zoom,n=e.bounds,r=e.marginBounds;console.log(t,a,n,r),E(t),S({lat:t.lat- -227e-8,lng:t.lng-131e-6}),I({lat:t.lat- -708e-8,lng:t.lng- -16e-5}),C(a)},options:{mapTypeControl:!0,controlSize:20},onChildMouseDown:function(e,t,a){U(!1)},onChildMouseUp:function(e,t,a){U(!0)},onChildClick:function(e,t){console.log("Child click ",e,t)},onChildMouseMove:function(e,t,a){"0"===e&&S(c({lat:a.lat,lng:a.lng},a)),"1"===e&&I(c({lat:a.lat,lng:a.lng},a))}},l.default.createElement((function(e){return e.lat,e.lng,l.default.createElement("img",{src:"./imgs/markerA.svg",style:{transform:"translate(-".concat(48,"%, -").concat(90,"%)")},height:x[v],alt:"Marker A"})}),{key:0,lat:P.lat,lng:P.lng}),l.default.createElement((function(e){return e.lat,e.lng,l.default.createElement("img",{src:"./imgs/markerB.svg",style:{transform:"translate(-".concat(48,"%, -").concat(90,"%)")},height:x[v],alt:"Marker B"})}),{key:1,lat:R.lat,lng:R.lng}))))},exports.imageDimensions=function(e){return new Promise((function(t,a){var n=new Image;n.onload=function(){var e=n.naturalWidth,a=n.naturalHeight;t({width:e,height:a})},n.onerror=function(){a("There was some problem with the image.")},n.src=URL.createObjectURL(e)}))};
//# sourceMappingURL=index.js.map
